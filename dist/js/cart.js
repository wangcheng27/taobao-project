"use strict";$(function(){var i=getCookie("username");if(!i){var t=layer.msg("请先登录！");return setTimeout(function(){layer.close(t),localStorage.setItem("url",location.href),location.href="./logon.html"},2e3),!1}var c,r,e=localStorage.getItem("data");function d(){var n=0,a=0;$('[name="selectOne"]:checked').each(function(t,e){n+=+$(e).parent().siblings(".number").find('input[name="number"]').val(),a+=+$(e).parent().siblings(".subtotal").find("span").text()}),console.log(n),$(".totalNum").text(n),$(".totalPrice").text(a)}e&&0!=JSON.parse(e).length?(e=(c=JSON.parse(e)).map(function(t){if(t.username===i)return t.goodsid}).join(","),console.log(e),r=layer.load(0,{shade:!0}),$.ajax({url:"/cart",data:{ids:e},dataType:"json",success:function(t){for(var e=t.data,n="",a=0;a<e.length;a++){var s=c.find(function(t){return t.username===i&&t.goodsid==e[a].id}).number;n+='\n                    <tr valign="bottom">\n                    <td class="contain-centent"><input type="checkbox" name="selectOne"></td>\n                    <td><img src="'+e[a].imgpath+'" width="50"\n                            height="50"></td>\n                    <td>'+e[a].name+'</td>\n                    <td class="price">￥<span>'+e[a].price+'</span></td>\n                    <td class="number" data-stock="'+e[a].stock+'" data-id="'+e[a].id+'">\n                        <button class="btn btn-default reduce">-</button>\n                        <input type="number" name="number" value="'+s+'">\n                        <button class="btn btn-default add">+</button>\n                    </td>\n                    <td class="subtotal">￥<span>'+e[a].price*s+'</span></td>\n                    <td><a class="btn btn-danger remove" href="#">删除</a></td>\n                </tr>\n                    '}$(".cart table tbody").html(n),layer.close(r),$('[name="selectAll"]').click(function(){$('[name="selectOne"]').prop("checked",$(this).prop("checked")),$('[name="selectAll"]').prop("checked",$(this).prop("checked")),d()}),$('[name="selectOne"]').click(function(){var t=Array.prototype.slice.call($('[name="selectOne"]')).every(function(t){return t.checked});$('[name="selectAll"]').prop("checked",t),d()}),$("table .number .add").click(function(){var t=+$(this).prev().val();$("table .number .reduce").prop("disabled",!1),++t>=$(this).parent().attr("data-stock")&&(t=$(this).parent().attr("data-stock"),$(this).prop("disabled",!0)),$(this).prev().val(t);var e=JSON.parse(localStorage.getItem("data")),n=$(this).parent().attr("data-id");e.find(function(t){return t.username===i&&t.goodsid===n}).number=t,localStorage.setItem("data",JSON.stringify(e));t=+$(this).parent().siblings(".price").find("span").text()*t;$(this).parent().siblings(".subtotal").find("span").text(t),d()}),$("table .number .reduce").click(function(){var t=+$(this).next().val();$("table .number .add").prop("disabled",!1),--t<=1&&(t=1,$(this).prop("disabled",!0)),$(this).next().val(t);var e=JSON.parse(localStorage.getItem("data")),n=$(this).parent().attr("data-id");e.find(function(t){return t.username===i&&t.goodsid===n}).number=t,localStorage.setItem("data",JSON.stringify(e));t=+$(this).parent().siblings(".price").find("span").text()*t;$(this).parent().siblings(".subtotal").find("span").text(t),d()}),$(".remove").click(function(){var a=$(this);layer.confirm("你确定要删除吗？",{btn:["确定","取消"]},function(){var t=JSON.parse(localStorage.getItem("data")),e=a.parent().siblings(".number").attr("data-id"),n=t.findIndex(function(t){return t.username===i&&t.goodsid===e});t.splice(n,1),a.parent().parent().remove(),d(),localStorage.setItem("data",JSON.stringify(t)),layer.msg("删除成功",{icon:1,time:500}),(t=JSON.parse(localStorage.getItem("data"))).length||$(".g-bd").html('\n                        <div class="g-row">\n                        <div class="m-cart-tips cart-empty-tips">\n                            <span class="u-icon icon-cart-tips icon-cart-empty"></span>\n                            <div class="cart-tips-cnt">\n                                <div class="cart-tips-text">\n                                    <p class="c-empty-title">购物袋空空如也，</p>\n                                    <p class="c-empty-text">快去抢购心仪商品吧~</p>\n                                </div>\n                                <div class="cart-tips-actions">\n                                    <a class="ui-btn-primary  ui-btn-medium" href="./list.html?pid=2">立即抢购 </a>\n                                    <a class="ui-btn-default  ui-btn-medium" href="#" role="button">查看订单</a>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="c-tabs  c-tabs-brands" id="J_recommend_box">\n                            <div class="c-tabs-content">\n                                <div class="c-tabs-panel list-recommend is-tabs-panel-active hidden" id="J_recommend_bd"></div>\n                            </div>\n                        </div>\n                    </div>\n                        ')},function(){return layer.msg("已取消",{icon:1,time:500}),!1})}),d()}})):$(".g-bd").html('\n        <div class="g-row">\n        <div class="m-cart-tips cart-empty-tips">\n            <span class="u-icon icon-cart-tips icon-cart-empty"></span>\n            <div class="cart-tips-cnt">\n                <div class="cart-tips-text">\n                    <p class="c-empty-title">购物袋空空如也，</p>\n                    <p class="c-empty-text">快去抢购心仪商品吧~</p>\n                </div>\n                <div class="cart-tips-actions">\n                    <a class="ui-btn-primary  ui-btn-medium" href="./list.html?pid=2">立即抢购 </a>\n                    <a class="ui-btn-default  ui-btn-medium" href="#" role="button">查看订单</a>\n                </div>\n            </div>\n        </div>\n        <div class="c-tabs  c-tabs-brands" id="J_recommend_box">\n            <div class="c-tabs-content">\n                <div class="c-tabs-panel list-recommend is-tabs-panel-active hidden" id="J_recommend_bd"></div>\n            </div>\n        </div>\n    </div>\n        ')});